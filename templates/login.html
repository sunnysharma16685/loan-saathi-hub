{% extends 'base.html' %}
{% block title %}Login - LoanSaathiHub{% endblock %}

{% block content %}
<div class="mx-auto" style="max-width:420px">
  <div class="card p-4 shadow-sm">

    <h4 class="text-center mb-3">Login</h4>
    <p class="text-center text-muted small mb-4">
      Please select user type and login using User ID, Mobile Number or Email
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="mb-2 fw-bold text-{{ 'danger' if category == 'danger' else 'success' }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Role Selection -->
    <div class="text-center mb-3">
      <button type="button" id="btnUser" class="btn btn-primary me-2">User</button>
      <button type="button" id="btnAgent" class="btn btn-outline-secondary">Agent</button>
    </div>

    <form method="POST" action="{{ url_for('login') }}">
      <input type="hidden" name="role" id="role" value="{{ request.form.get('role','user') }}">

      <div class="mb-2">
        <label class="form-label">User ID / Mobile / Email</label>
        <input class="form-control" name="identifier" placeholder="Enter User ID, Mobile Number or Email" 
               value="{{ request.form.get('identifier','') }}" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Password</label>
        <input class="form-control" name="password" placeholder="Password" type="password" required>
      </div>

      <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="window.location.href='{{ url_for('index') }}'">Back</button>
        <button type="submit" class="btn btn-primary">Login</button>
      </div>
    </form>
  </div>
</div>

<script>
  const btnUser = document.getElementById('btnUser');
  const btnAgent = document.getElementById('btnAgent');
  const roleInput = document.getElementById('role');

  function selectRole(role) {
    roleInput.value = role;
    if (role === 'user') {
      btnUser.classList.remove('btn-outline-secondary');
      btnUser.classList.add('btn-primary');
      btnAgent.classList.remove('btn-primary');
      btnAgent.classList.add('btn-outline-secondary');
    } else {
      btnAgent.classList.remove('btn-outline-secondary');
      btnAgent.classList.add('btn-primary');
      btnUser.classList.remove('btn-primary');
      btnUser.classList.add('btn-outline-secondary');
    }
  }

  // Initialize
  selectRole(roleInput.value);

  btnUser.addEventListener('click', () => selectRole('user'));
  btnAgent.addEventListener('click', () => selectRole('agent'));
</script>
{% endblock %}
