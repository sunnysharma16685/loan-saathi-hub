{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Loan Saathi Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        table { border-collapse: collapse; width: 100%; margin-bottom: 40px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #0d6efd; color: white; }
        select { padding: 5px; border-radius: 4px; border: 1px solid #ccc; }
        button { padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; }
        .btn-approve { background: #198754; color: white; }
        .btn-reject { background: #dc3545; color: white; }
    </style>
</head>
<body style="font-family: 'Poppins', sans-serif; background-color: #f8f9fa;">

    <!-- Header -->
    <header style="background-color: #0d6efd; padding: 15px; display: flex; justify-content: space-between; align-items: center; color: #fff;">
        <h2 style="margin: 0;">Loan Saathi Hub - Admin Dashboard</h2>
        <div>
            <a href="{% url 'home' %}" style="color: white; margin-right: 20px; text-decoration: none;">Home</a>
            <a href="{% url 'logout' %}" style="color: white; text-decoration: none;">Logout</a>
        </div>
    </header>

    <div style="padding: 20px;">
        <h3>Welcome, {{ request.user.first_name }} (Admin)</h3>

        <!-- Loan Requests Table -->
        <h4>All Loan Requests</h4>
        <table>
            <thead>
                <tr>
                    <th>Sl No.</th>
                    <th>Loan ID</th>
                    <th>User Name</th>
                    <th>Loan Type</th>
                    <th>Amount</th>
                    <th>Duration</th>
                    <th>Rate of Interest</th>
                    <th>Status</th>
                    <th>Agent Assigned</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for loan in loans %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ loan.loan_id }}</td>
                    <td>{{ loan.user.first_name }} {{ loan.user.last_name }}</td>
                    <td>{{ loan.loan_type }}</td>
                    <td>₹{{ loan.amount_requested }}</td>
                    <td>{{ loan.duration_months }} months</td>
                    <td>{{ loan.interest_rate }}%</td>
                    <td>{{ loan.status }}</td>
                    <td>{% if loan.agent %}{{ loan.agent.first_name }}{% else %}-{% endif %}</td>
                    <td>
                        <button class="btn-approve">Approve</button>
                        <button class="btn-reject">Reject</button>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="10">No Loan Requests Found</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Users Table -->
        <h4>All Users</h4>
        <table>
            <thead>
                <tr>
                    <th>Sl No.</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Mobile</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ u.first_name }} {{ u.last_name }}</td>
                    <td>{{ u.email }}</td>
                    <td>{{ u.mobile }}</td>
                    <td>
                        <select>
                            <option value="active" {% if u.is_active %}selected{% endif %}>Active</option>
                            <option value="inactive" {% if not u.is_active %}selected{% endif %}>Inactive</option>
                        </select>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No Users Found</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Agents Table -->
        <h4>All Agents</h4>
        <table>
            <thead>
                <tr>
                    <th>Sl No.</th>
                    <th>Full Name</th>
                    <th>Business Type</th>
                    <th>Mobile</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for a in agents %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ a.first_name }} {{ a.last_name }}</td>
                    <td>{{ a.business_type }}</td>
                    <td>{{ a.mobile }}</td>
                    <td>
                        <select>
                            <option value="active" {% if a.is_active %}selected{% endif %}>Active</option>
                            <option value="inactive" {% if not a.is_active %}selected{% endif %}>Inactive</option>
                        </select>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No Agents Found</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Payments Table -->
        <h4>All Payments</h4>
        <table>
            <thead>
                <tr>
                    <th>Sl No.</th>
                    <th>Payment ID</th>
                    <th>Loan ID</th>
                    <th>Agent Name</th>
                    <th>Amount</th>
                    <th>Method</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for p in payments %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ p.id }}</td>
                    <td>{{ p.loan_request.loan_id }}</td>
                    <td>{{ p.agent.first_name }}</td>
                    <td>₹{{ p.amount }}</td>
                    <td>{{ p.payment_method }}</td>
                    <td>{{ p.status }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="7">No Payments Found</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Reports Table -->
        <h4>Loan Reports</h4>
        <table>
            <thead>
                <tr>
                    <th>Loan Type</th>
                    <th>Total Applications</th>
                    <th>Approved</th>
                    <th>Rejected</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>{{ report.loan_type }}</td>
                    <td>{{ report.total }}</td>
                    <td>{{ report.approved }}</td>
                    <td>{{ report.rejected }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4">No Reports Found</td></tr>
                {% endfor %}
            </tbody>
        </table>

    </div>

    <!-- Footer -->
    {% include 'footer.html' %}
</body>
</html>
