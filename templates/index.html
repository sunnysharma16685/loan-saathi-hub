{% extends "base.html" %} 
{% block title %}Home - LoanSaathiHub{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-6">
    <div class="big-ad border rounded p-5 text-center">Big Advertisement</div>
    <div class="mt-3 running-ads p-2 bg-warning"><marquee>Running ads... Apply now!</marquee></div>
  </div>

  <div class="col-md-6">
    <div class="card p-4 shadow-sm">
      <h4>Select Register</h4>
      <div class="mb-3">
        <button id="btnUser" class="btn btn-primary me-2">User</button>
        <button id="btnAgent" class="btn btn-outline-secondary">Agent</button>
      </div>
      <form id="basicProfileForm" method="POST" action="{{ url_for('register_basic') }}">
        <input type="hidden" name="user_type" id="user_type" value="user">
        <div class="mb-2"><input class="form-control" name="first_name" placeholder="First name" required></div>
        <div class="mb-2"><input class="form-control" name="last_name" placeholder="Last name" required></div>

        <!-- Mobile + Send OTP -->
        <div class="mb-2">
          <div class="input-group">
            <input class="form-control" name="mobile" id="mobileInput" placeholder="Mobile" pattern="[0-9]{10}" required>
            <button type="button" class="btn btn-outline-secondary" id="sendOtpBtn">Send OTP</button>
          </div>
        </div>

        <!-- OTP input hidden initially -->
        <div class="mb-2" id="otpWrap" style="display:none;">
          <input class="form-control" name="otp" placeholder="Enter OTP" required>
        </div>

        <!-- Password & Confirm Password -->
        <div class="row mb-2">
          <div class="col">
            <input type="password" class="form-control" name="password" placeholder="Create password" required>
          </div>
          <div class="col">
            <input type="password" class="form-control" name="password2" placeholder="Confirm password" required>
          </div>
        </div>

        <div class="mb-2"><input class="form-control" name="email" placeholder="Email" type="email" required></div>
        <button class="btn btn-success w-100">Next</button>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btnUser = document.getElementById('btnUser');
    const btnAgent = document.getElementById('btnAgent');
    const userTypeInput = document.getElementById('user_type');

    btnUser.addEventListener('click', () => {
      btnUser.classList.add('btn-primary'); btnUser.classList.remove('btn-outline-secondary');
      btnAgent.classList.remove('btn-primary'); btnAgent.classList.add('btn-outline-secondary');
      userTypeInput.value = 'user';
    });

    btnAgent.addEventListener('click', () => {
      btnAgent.classList.add('btn-primary'); btnAgent.classList.remove('btn-outline-secondary');
      btnUser.classList.remove('btn-primary'); btnUser.classList.add('btn-outline-secondary');
      userTypeInput.value = 'agent';
    });

    // OTP Send logic
    const sendBtn = document.getElementById('sendOtpBtn');
    const otpWrap = document.getElementById('otpWrap');
    const mobileEl = document.getElementById('mobileInput');

    sendBtn.addEventListener('click', async () => {
      const mobile = (mobileEl.value || '').trim();

      if (!/^\d{10}$/.test(mobile)) {
        alert('Please enter a valid 10-digit mobile');
        mobileEl.focus();
        return;
      }

      try {
        const res = await fetch('/send_otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: 'mobile=' + encodeURIComponent(mobile)
        });
        const data = await res.json();

        if (data.ok) {
          otpWrap.style.display = 'block';
          alert("Your OTP (demo): " + data.otp); // demo ke liye
        } else {
          alert(data.message || 'Failed to send OTP');
        }
      } catch (e) {
        alert('Network error while sending OTP');
      }
    });
  });
</script>
{% endblock %}
