{% extends 'base.html' %}

{% block title %}Login - LoanSaathiHub{% endblock %}

{% block content %}
<div style="max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">

    <h2 style="text-align:center; color:#004080; margin-bottom: 20px;">Login</h2>
    <p style="text-align:center; color:#333; font-weight: bold; margin-bottom: 20px;">
      Please select user type and login using User ID, Mobile Number or Email
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div style="color: {% if category == 'danger' %}red{% elif category == 'success' %}green{% else %}black{% endif %}; margin-bottom:10px;">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Ensure this action points to the login route function name in app.py -->
    <form method="POST" action="{{ url_for('login') }}">
        <div style="text-align:center; margin-bottom: 20px;">
            <button type="button" id="btnUser" style="background:#004080; color:#fff; border:none; padding:10px 20px; margin-right: 10px; border-radius:5px; cursor:pointer;">
                User
            </button>
            <button type="button" id="btnAgent" style="background:#ccc; color:#000; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">
                Agent
            </button>
        </div>

        <input type="hidden" name="role" id="role" value="{{ request.form.get('role','user') }}">

        <label for="identifier">User ID / Mobile / Email:</label><br/>
        <input type="text" id="identifier" name="identifier" placeholder="Enter User ID, Mobile Number or Email" value="{{ request.form.get('identifier','') }}" required style="width: 100%; padding:8px; margin:6px 0" /><br/>

        <label for="password">Password:</label><br/>
        <input type="password" id="password" name="password" required style="width: 100%; padding:8px; margin:6px 0" /><br/>

        <div style="display:flex; justify-content:space-between; margin-top: 20px;">
            <!-- CHANGE 'homepage' here if your function is named differently -->
            <button type="button" style="background:#ccc; border:none; padding:10px 20px; cursor:pointer; border-radius: 5px;"
                onclick="window.location.href='{{ url_for('homepage') }}'">Back</button>

            <button type="submit" style="background:#004080; border:none; color:white; padding:10px 20px; cursor:pointer; border-radius:5px;">
                Login
            </button>
        </div>
    </form>
</div>

<script>
    const btnUser = document.getElementById('btnUser');
    const btnAgent = document.getElementById('btnAgent');
    const roleInput = document.getElementById('role');

    function selectRole(role) {
        roleInput.value = role;
        if (role === 'user') {
            btnUser.style.background = '#004080';
            btnUser.style.color = '#fff';
            btnAgent.style.background = '#ccc';
            btnAgent.style.color = '#000';
        } else {
            btnAgent.style.background = '#004080';
            btnAgent.style.color = '#fff';
            btnUser.style.background = '#ccc';
            btnUser.style.color = '#000';
        }
    }

    // Initialize on page load
    selectRole(roleInput.value);

    btnUser.addEventListener('click', () => selectRole('user'));
    btnAgent.addEventListener('click', () => selectRole('agent'));
</script>
{% endblock %}
