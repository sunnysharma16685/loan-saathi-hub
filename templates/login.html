{% extends "base.html" %}
{% load static %}

{% block title %}Login — Loan Saathi Hub{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6 col-lg-5">
    <div class="card shadow-lg border-0 rounded-4 p-4">
      <!-- Header -->
      <div class="text-center mb-4">
        <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-3" 
             style="width:60px;height:60px;">
          <i class="bi bi-person-lock text-primary fs-3"></i>
        </div>
        <h3 class="fw-bold mb-1">Welcome Back</h3>
        <p class="text-muted mb-0">Login to access your account</p>
      </div>

      <!-- ✅ Django Messages -->
      {% if messages %}
        <div class="mb-3">
          {% for message in messages %}
            <div class="alert 
                        {% if 'error' in message.tags %}alert-danger
                        {% elif 'warning' in message.tags %}alert-warning
                        {% elif 'success' in message.tags %}alert-success
                        {% else %}alert-info{% endif %}
                        alert-dismissible fade show small shadow-sm" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Form -->
      <form method="POST" id="loginForm" novalidate action="{% url 'login' %}">
        {% csrf_token %}

        <!-- Role -->
        <div class="mb-3">
          <label for="role" class="form-label fw-semibold">Login as</label>
          <select name="role" id="role" class="form-select" required autocomplete="off">
            <option value="">-- Select Role --</option>
            <option value="applicant" {% if role == "applicant" %}selected{% endif %}>Applicant</option>
            <option value="lender" {% if role == "lender" %}selected{% endif %}>Lender</option>
          </select>
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label for="email" class="form-label fw-semibold">Email</label>
          <input type="email" 
                 name="email" 
                 id="email" 
                 class="form-control"
                 value="{{ email|default:'' }}" 
                 required autocomplete="email" autofocus>
        </div>

        <!-- Password -->
        <div class="mb-3">
          <label for="password" class="form-label fw-semibold">Password</label>
          <div class="input-group">
            <input type="password" 
                   name="password" 
                   id="password" 
                   class="form-control" 
                   required 
                   autocomplete="current-password">
            <button type="button" class="btn btn-outline-secondary" id="togglePassword">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>

        <!-- Submit -->
        <div class="d-grid mt-4">
          <button type="submit" class="btn btn-primary btn-lg rounded-3 shadow-sm">
            <i class="bi bi-box-arrow-in-right me-1"></i> Login
          </button>
        </div>

        <!-- Links -->
        <div class="text-center mt-4 small">
          <a href="{% url 'forgot_password' %}" class="text-decoration-none">Forgot password?</a> &nbsp;|&nbsp;
          <a href="{% url 'register' %}" class="text-decoration-none fw-semibold">New user? Register</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("loginForm");

  if (form) {
    form.addEventListener("submit", function(e) {
      const role = (document.getElementById("role")?.value || "").trim();
      const email = (document.getElementById("email")?.value || "").trim();
      const password = document.getElementById("password")?.value || "";

      if (!role) {
        e.preventDefault();
        Swal.fire("Error", "⚠️ Please select a role (Applicant or Lender).", "warning");
        return;
      }
      if (!email || !password) {
        e.preventDefault();
        Swal.fire("Error", "⚠️ Please enter both email and password.", "warning");
        return;
      }
    });
  }

  // ✅ Password show/hide toggle
  const togglePassword = document.getElementById("togglePassword");
  if (togglePassword) {
    togglePassword.addEventListener("click", () => {
      const passwordInput = document.getElementById("password");
      const icon = togglePassword.querySelector("i");
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        icon.classList.replace("bi-eye", "bi-eye-slash");
      } else {
        passwordInput.type = "password";
        icon.classList.replace("bi-eye-slash", "bi-eye");
      }
    });
  }
});
</script>
{% endblock %}
