{# File: templates/loan_request.html #}
{% extends 'base.html' %}

{% block title %}Loan Request - LoanSaathiHub{% endblock %}

{% block meta %}
  <meta name="description" content="Submit your detailed loan request with PAN, Aadhar, income details and get the best loan offers.">
  <meta name="keywords" content="Loan Application, PAN Loan Form, CIBIL based Loan, ITR Loan, LoanSaathiHub">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
{% endblock %}

{% block content %}
<div class="container">
  <section class="signup-form">
    <h2>Loan Request Form</h2>
    <p>Complete the form below to request your desired loan. Ensure details are accurate for faster processing.</p>

    <form method="POST" action="/loan-request">

      <!-- Loan Type -->
      <label for="loan_type">Loan Type*</label>
      <select name="loan_type" id="loan_type" required>
        <option value="">-- Select --</option>
        <option value="Personal">Personal</option>
        <option value="Home">Home</option>
        <option value="Business">Business</option>
        <option value="Vehicle">Vehicle</option>
      </select>

      <!-- Amount -->
      <label for="amount">Amount Required (â‚¹)*</label>
      <input type="number" id="amount" name="amount" min="10000" step="1000" placeholder="e.g. 500000" required>

      <!-- Duration -->
      <label for="duration">Duration (in Months)*</label>
      <input type="number" id="duration" name="duration" min="6" max="84" placeholder="e.g. 24" required>

      <!-- Pincode (Auto-Fill City & State using JS) -->
      <label for="pincode">PIN Code*</label>
      <input type="text" id="pincode" name="pincode" pattern="\d{6}" placeholder="6-digit PIN Code" required>

      <label for="city">City*</label>
      <input type="text" id="city" name="city" placeholder="City" required readonly>

      <label for="state">State*</label>
      <input type="text" id="state" name="state" placeholder="State" required readonly>

      <!-- PAN Number -->
      <label for="pan">PAN Number*</label>
      <input type="text" id="pan" name="pan" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" placeholder="ABCDE1234F" required>

      <!-- Aadhar Number (Optional) -->
      <label for="aadhar">Aadhar Number (Optional)</label>
      <input type="text" id="aadhar" name="aadhar" pattern="\d{12}" placeholder="12-digit Aadhar Number">

      <!-- ITR Details -->
      <label for="itr">Income Tax Return (ITR) Filed For*</label>
      <select name="itr" id="itr" required>
        <option value="">-- Select --</option>
        <option value="Last 3 Years">Last 3 Years</option>
        <option value="Last 2 Years">Last 2 Years</option>
        <option value="Last 1 Year">Last 1 Year</option>
        <option value="No ITR">No ITR</option>
      </select>

      <!-- CIBIL Score -->
      <label for="cibil">CIBIL Score (if known)</label>
      <input type="number" id="cibil" name="cibil" min="300" max="900" placeholder="e.g. 750">

      <button type="submit" class="btn-primary">Submit Loan Request</button>
    </form>
  </section>
</div>

<script>
  // Auto-fetch City and State from PIN using Indian Postal API
  document.getElementById("pincode").addEventListener("blur", function() {
    const pin = this.value;
    if (pin.length === 6) {
      fetch(`https://api.postalpincode.in/pincode/${pin}`)
        .then(res => res.json())
        .then(data => {
          if (data[0].Status === "Success") {
            document.getElementById("city").value = data[0].PostOffice[0].District;
            document.getElementById("state").value = data[0].PostOffice[0].State;
          } else {
            alert("Invalid PIN Code.");
            document.getElementById("city").value = '';
            document.getElementById("state").value = '';
          }
        });
    }
  });
</script>
{% endblock %}
