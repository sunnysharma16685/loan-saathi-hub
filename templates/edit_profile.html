{% extends "base.html" %}
{% block content %}
{% if request.user.role == 'applicant' %}
  {% url 'dashboard_applicant' as dashboard_url %}
{% elif request.user.role == 'lender' %}
  {% url 'dashboard_lender' as dashboard_url %}
{% else %}
  {% url 'index' as dashboard_url %}
{% endif %}

<style>
  body { font-family: 'Poppins', sans-serif; background: #f5f8fa; }
  .container { max-width: 1000px; margin-top: 30px; }
  h2, h4, h5 { color:#333; margin-top: 20px; }
  form { background:#fff; padding:25px; border-radius:12px; box-shadow:0 8px 16px rgba(0,0,0,0.06); }
  label { font-weight:600; color:#555; margin-top:10px; display:block; }
  input, select, textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; margin-top:5px; transition:0.2s; }
  input:focus, select:focus, textarea:focus { border-color:#0d6efd; outline:none; box-shadow:0 6px 18px rgba(13,110,253,0.08); }
  .readonly-field { background-color:#f8f9fa; border:1px solid #e9ecef; color:#6c757d; pointer-events:none; }
  .btn-primary { background:#0d6efd; color:#fff; border:none; padding:12px 16px; border-radius:8px; font-weight:600; }
  .btn-primary:hover { background:#084298; }
  .btn-secondary { background:#6c757d; color:#fff; padding:12px 16px; border-radius:8px; text-decoration:none; }
  .btn-secondary:hover { background:#495057; }
  .form-actions { display:flex; gap:12px; margin-top:18px; }
  @media (max-width:575px){ .form-actions{ flex-direction:column; } }
</style>


  <h2>Edit Profile</h2>
  <form method="POST" action="">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ dashboard_url }}">

    <!-- Common Profile -->
    <h4>Basic Information</h4>
    <div class="row g-3">
      <div class="col-md-6">
        <label>Full Name</label>
        <input type="text" name="full_name" class="form-control readonly-field" value="{{ profile.full_name }}" readonly>
      </div>
      <div class="col-md-6">
        <label>Mobile</label>
        <input type="text" name="mobile" class="form-control readonly-field" value="{{ profile.mobile }}" readonly>
      </div>
      <div class="col-md-6">
        <label>Gender</label>
        <input type="text" name="gender" class="form-control" value="{{ profile.gender }}">
      </div>
      <div class="col-md-6">
        <label>Marital Status</label>
        <input type="text" name="marital_status" class="form-control" value="{{ profile.marital_status }}">
      </div>
      <div class="col-md-6">
        <label>Address</label>
        <textarea name="address" class="form-control">{{ profile.address }}</textarea>
      </div>
      <div class="col-md-3">
        <label>Pincode</label>
        <input type="text" name="pincode" class="form-control" value="{{ profile.pincode }}">
      </div>
      <div class="col-md-3">
        <label>City</label>
        <input type="text" name="city" class="form-control" value="{{ profile.city }}">
      </div>
      <div class="col-md-3">
        <label>State</label>
        <input type="text" name="state" class="form-control" value="{{ profile.state }}">
      </div>
      <div class="col-md-3">
        <label>PANCARD Number</label>
        <input type="text" name="pancard_number" class="form-control readonly-field" value="{{ profile.pancard_number }}" readonly>
      </div>
      <div class="col-md-3">
        <label>Aadhaar Number</label>
        <input type="text" name="aadhaar_number" class="form-control readonly-field" value="{{ profile.aadhaar_number }}" readonly>
      </div>
      <div class="col-md-3">
        <label>Date of Birth</label>
        <input type="date" name="dob" class="form-control readonly-field" value="{{ profile.dob|date:'Y-m-d' }}" readonly>
      </div>
    </div>

    {% if user.role == "applicant" %}
      <hr>
      <h4>Applicant Details</h4>
      <div class="row g-3">
        <div class="col-md-4"><label>Job Type</label><input type="text" name="job_type" class="form-control" value="{{ applicant_details.job_type }}"></div>
        <div class="col-md-4"><label>Employment Type</label><input type="text" name="employment_type" class="form-control" value="{{ applicant_details.employment_type }}"></div>
        
<!-- CIBIL Score (readonly) -->
<div class="mb-3">
  <label class="form-label">CIBIL Score (300-900)</label>

  {% if applicant_details.cibil_score %}
    <input type="number" class="form-control"
           value="{{ applicant_details.cibil_score }}"
           readonly style="background:#f8f9fa; cursor:not-allowed;">
    <small class="text-muted">
      Generated on {{ applicant_details.cibil_generated_at|date:"d M Y, H:i" }}
    </small>
  {% else %}
    <input type="text" class="form-control"
           value="Not generated yet"
           readonly style="background:#f8f9fa; cursor:not-allowed;">
    <small class="text-muted">
      A lender will generate your CIBIL score during loan review.
    </small>
  {% endif %}
</div>


      <h5>Job Information</h5>
      <div class="row g-3">
        <div class="col-md-4"><label>Company Name</label><input type="text" name="company_name" class="form-control" value="{{ applicant_details.company_name }}"></div>
        <div class="col-md-4"><label>Company Type</label><input type="text" name="company_type" class="form-control" value="{{ applicant_details.company_type }}"></div>
        <div class="col-md-4"><label>Designation</label><input type="text" name="designation" class="form-control" value="{{ applicant_details.designation }}"></div>
        <div class="col-md-4"><label>ITR</label><input type="text" name="itr_job" class="form-control" value="{{ applicant_details.itr }}"></div>
        <div class="col-md-4"><label>Current Salary</label><input type="number" step="0.01" name="current_salary" class="form-control" value="{{ applicant_details.current_salary }}"></div>
        <div class="col-md-4"><label>Other Income</label><input type="number" step="0.01" name="other_income" class="form-control" value="{{ applicant_details.other_income }}"></div>
        <div class="col-md-4"><label>Total EMI (Job)</label><input type="number" step="0.01" name="total_emi" class="form-control" value="{{ applicant_details.total_emi }}"></div>
      </div>

      <h5>Business Information</h5>
      <div class="row g-3">
        <div class="col-md-4"><label>Business Name</label><input type="text" name="business_name" class="form-control" value="{{ applicant_details.business_name }}"></div>
        <div class="col-md-4"><label>Business Type</label><input type="text" name="business_type" class="form-control" value="{{ applicant_details.business_type }}"></div>
        <div class="col-md-4"><label>Business Sector</label><input type="text" name="business_sector" class="form-control" value="{{ applicant_details.business_sector }}"></div>
        <div class="col-md-4"><label>Total Turnover (3Y)</label><input type="number" step="0.01" name="total_turnover" class="form-control" value="{{ applicant_details.total_turnover }}"></div>
        <div class="col-md-4"><label>Last Year Turnover</label><input type="number" step="0.01" name="last_year_turnover" class="form-control" value="{{ applicant_details.last_year_turnover }}"></div>
        <div class="col-md-4"><label>Total EMI (Business)</label><input type="number" step="0.01" name="business_total_emi" class="form-control" value="{{ applicant_details.business_total_emi }}"></div>
        <div class="col-md-4"><label>Business ITR Status</label><input type="text" name="business_itr_status" class="form-control" value="{{ applicant_details.business_itr_status }}"></div>
      </div>

    {% elif user.role == "lender" %}
      <hr>
      <h4>Lender Details</h4>
      <div class="row g-3">
        <div class="col-md-4"><label>Lender Type</label><input type="text" name="lender_type" class="form-control" value="{{ lender_details.lender_type }}"></div>
        <div class="col-md-4"><label>DSA Code</label><input type="text" name="dsa_code" class="form-control" value="{{ lender_details.dsa_code }}"></div>
        <div class="col-md-4"><label>Bank/Firm Name</label><input type="text" name="bank_firm_name" class="form-control" value="{{ lender_details.bank_firm_name }}"></div>
        <div class="col-md-4"><label>GST Number</label><input type="text" name="gst_number" class="form-control" value="{{ lender_details.gst_number }}"></div>
        <div class="col-md-4"><label>Branch Name</label><input type="text" name="branch_name" class="form-control" value="{{ lender_details.branch_name }}"></div>
        <div class="col-md-4"><label>Designation</label><input type="text" name="designation" class="form-control" value="{{ lender_details.designation }}"></div>
      </div>
    {% endif %}

    <div class="form-actions">
      <button type="submit" class="btn-primary">Save Changes</button>
      <a href="{{ dashboard_url }}" class="btn-secondary">Back to Dashboard</a>
    </div>
  </form>
</div>
{% endblock %}
